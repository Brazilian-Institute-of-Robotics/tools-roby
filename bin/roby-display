#! /usr/bin/env ruby

require 'roby'
require 'roby/log'

require 'Qt'
require 'roby/log/event_stream'
require 'roby/log/plan_rebuilder'
require 'roby/log/relations_view/relations_canvas'

Roby.app.setup_drb_server

filename = ARGV.shift
app = Qt::Application.new(ARGV)

stream    = Roby::LogReplay::EventFileStream.open(filename)
rebuilder = Roby::LogReplay::PlanRebuilder.new(stream)
display = Roby::LogReplay::RelationsDisplay::RelationsCanvas.new(rebuilder, rebuilder.plans)
if File.file?('roby-display.yml')
    display.options(YAML.load(File.read('roby-display.yml')))
end
display.show

app.exec

File.open('roby-display.yml', 'w') do |io|
    YAML.dump(display.options, io)
end


